VITE_SUPABASE_URL=https://cbzbqzklsdetafwvnkkd.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNiemJxemtsc2RldGFmd3Zua2tkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4OTM1ODUsImV4cCI6MjA3OTQ2OTU4NX0.nKXdqvtGOXjqOLCc2pVGpxMI9cwYrf19EZUdMVjYVVA

DATABASE_URL=postgresql://postgres:Billion$2025@db.cbzbqzklsdetafwvnkkd.supabase.co:5432/postgres

SERVICE_ROLE_KEY=615b45d1-7b4d-409e-9df3-a466cbcd14ed
ADMIN_EMAIL=admin@example.com
ADMIN_PASSWORD=Admin@123
-- Enable row level security on both tables
ALTER TABLE public.users ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.download_links ENABLE ROW LEVEL SECURITY;

-- Users: allow users to insert/select/update their own row
DROP POLICY IF EXISTS users_insert_own ON public.users;
CREATE POLICY users_insert_own ON public.users
  FOR INSERT
  WITH CHECK (auth.uid() = id);

DROP POLICY IF EXISTS users_select_own ON public.users;
CREATE POLICY users_select_own ON public.users
  FOR SELECT
  USING (auth.uid() = id);

DROP POLICY IF EXISTS users_update_own ON public.users;
CREATE POLICY users_update_own ON public.users
  FOR UPDATE
  USING (auth.uid() = id)
  WITH CHECK (auth.uid() = id);

-- Users: admin manage (admin users can manage users table)
DROP POLICY IF EXISTS users_admin_manage ON public.users;
CREATE POLICY users_admin_manage ON public.users
  FOR ALL
  USING (exists (select 1 from public.users u where u.id = auth.uid() and u.role = 'admin'))
  WITH CHECK (exists (select 1 from public.users u where u.id = auth.uid() and u.role = 'admin'));

-- Download links: public read + admin manage
DROP POLICY IF EXISTS download_links_public_read ON public.download_links;
CREATE POLICY download_links_public_read ON public.download_links
  FOR SELECT
  USING (true);

DROP POLICY IF EXISTS download_links_admin_manage ON public.download_links;
CREATE POLICY download_links_admin_manage ON public.download_links
  FOR ALL
  USING (exists (select 1 from public.users u where u.id = auth.uid() and u.role = 'admin'))
  WITH CHECK (exists (select 1 from public.users u where u.id = auth.uid() and u.role = 'admin'));
